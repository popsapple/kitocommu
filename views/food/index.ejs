<!DOCTYPE html>
<html class="sub" lang="ko">
<head>
  <link rel="stylesheet" type="text/css" href="/other/others.css" />
  <% include ../partials/header.ejs %>
  <% include ../partials/nav.ejs %>
  <main role="main">
  <div class="sub designcustom">
      <div class="container board normal">
        <% include ../partials/sub_visual.ejs %>
        <article class="introduce_foods">
          <h1>
            식품정보찾기 (제작중입니다)
          </h1>
          <form>
            <ul>
                <li>
                    <label>식품명</label>
                    <input type="text" name="foodname" id="foodname" />
                </li>
            </ul>
            <button type="button" id="search_food"class="btn btn-default">조회</button accesskey="s">
          </form>
          <hr />
          <div id="food_result">
            <h2></h2>
            <ul></ul>
          </div>
        </article>
      </div>
    </div>
<% include ../partials/footer.ejs %>

<script>
    

    $("#search_food").on('click', function(){
        $.ajax({
          type: "POST",
              url: "/food_search",
              data: JSON.stringify({
                "foodname" : $("#foodname").val()
              }),
              contentType: "application/json",
              success: function(data) {
                if(!data.foodname){
                  alert("입력하신 조건에 맞는 음식을 찾지 못했습니다.");
                  return false;
                }
                $("#food_result > ul").html("");
                $("#food_result > h2").html(data.foodname+"의 검색결과는 다음과 같습니다.");

                var foodlist = JSON.parse( data.foodlist);
                foodlist.forEach(function(item,idx){
                  console.log("신규추가");
                  $("#food_result > ul").prepend("<li></li>");
                  $("#food_result > ul > li").eq(0).html("<h3>"+item.name[0]+"</h3>"+"<ul>"+
                    "<li><strong>중량(g)</strong>"+item.weight[0]+"</li>"+
                    "<li><strong>칼로리</strong>"+item.kcal[0]+"</li>"+
                    "<li><strong>탄수화물(g)</strong>"+item.carbon[0]+"</li>"+
                    "<li><strong>단백질(g)</strong>"+item.protein[0]+"</li>"+
                    "<li><strong>지방(g)</strong>"+item.fat[0]+"</li>"+
                    "<li><strong>식이섬유(g)</strong>"+item.fiber[0]+"</li>"+
                    "<li><strong>물(g)</strong>"+item.water[0]+"</li>"+
                    "</ul>")
                })
                self.close();
              },
              error: function(data) {
                  console.log("Error!!!!!!!!!!!!");
              }
        });
      return false;
    });
</script>
</body>
</html>
